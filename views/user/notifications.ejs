<!DOCTYPE html>
<!-- ===== Page: Notifications ===== -->
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô - Home4Pets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="/style.css">
</head>
<body>

<nav class="navbar">
  <div class="d-flex align-items-center gap-2">
    <img src="/green_house_logo-removebg-preview.png" alt="Logo" style="height: 30px; margin-right: 8px;"> <a href="/home" style="text-decoration: none;"><span class="navbar-brand">Home4Pets</span></a>
  </div>

  <div class="d-flex align-items-center">
    <a class="nav-link" href="/home">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    <a class="nav-link" href="/home">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏±‡∏ï‡∏ß‡πå</a>
    <a class="nav-link" href="/recommended">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</a>
    <a class="nav-link" href="/favorites">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</a>

    <a href="/notifications" class="notification-bell ms-3" aria-label="Notifications">
      üîî
      <span class="notification-count" id="notificationCount">0</span>
    </a>

    <div class="user-badge ms-3">
      <span><%= (user && user.name) ? user.name : '' %></span>
      <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png">
    </div>
  </div>
</nav>

<section class="hero" style="background-image: url('/banner.jpg'); background-size: cover; background-position: center;"></section>

<div class="container mt-4">
  <h5 class="mb-3">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h5>

  <% if (!notifications || notifications.length === 0) { %>
    <div class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
  <% } %>

  <div class="list-group">
    <% (notifications || []).forEach(item => { %>
      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center <%= item.isRead ? '' : 'notification-unread' %>"
         href="/pet/<%= item.petId %>?notificationId=<%= item.id %>">
        <div>
          <div><%= item.message %></div>
          <small class="text-muted">
            <%= item.type === 'favorite_adopted' ? '‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ñ‡∏π‡∏Å‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á' : (item.type === 'new_pet_match' ? '‡∏°‡∏µ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à' : '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô') %>
            ‚Ä¢ <%= new Date(item.createdAt).toLocaleString('th-TH') %>
          </small>
        </div>
        <span class="badge" style="background: #e9f7f3; color: #2f6f62;">‡πÉ‡∏´‡∏°‡πà</span>
      </a>
    <% }); %>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
(function initNotifications() {
  const countEl = document.getElementById('notificationCount');
  if (!countEl) return;

  const source = new EventSource('/notifications/stream');
  source.addEventListener('message', (event) => {
    try {
      const data = JSON.parse(event.data || '{}');
      const count = Number(data.unreadCount || 0);
      countEl.textContent = count > 99 ? '99+' : String(count);
      countEl.style.display = count > 0 ? 'inline-flex' : 'none';
    } catch (err) {
      // ignore
    }
  });
})();
</script>

</body>
</html>
